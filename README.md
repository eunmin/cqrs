# CQRS 패턴

https://docs.microsoft.com/ko-kr/azure/architecture/patterns/cqrs

- 읽기와 쓰기를 분리하는 패턴
- 성능, 확장성, 보안성을 극대화 할 수 있다

## 문제점

- CRUD에서 DTO가 쓰기에는 일부 필드를 사용하고 읽기는 모든 필드를 사용하는 모델링 많이 사용한다.
- 읽기와 쓰기에 모델 불일치
- 쓰기에 대한 읽기 LOCK로 성능 저하
- 쓰기와 읽기가 분리되어 있다면 보안도 더 쉽게 다룰 수 있다

## 해결 방법

- 읽기와 쓰기 모델을 분리한다
- 스캐폴드 자동 생성 지원이 되지 않는다
- 읽기 쓰기 저장소는 다른 구조여도 된다
- 읽기 저장소를 여러개로 복제하면 성능이 좋아진다
- 읽기 쓰기를 분리하면 부하를 감안해서 적절하게 확장 할 수 있다
- 보통 읽기 부하가 많다

## 문제 및 고려 사항

- 복원력과 일관성에 문제가 있을 수 있다
- 결과적 일관성을 위해 이벤트 소싱을 사용한다.

## 이 패턴을 사용하는 경우

- 읽기/쓰기간 도메인 수준의 충돌을 줄일 수 있다.
- DDD에 유용한다. 읽기는 유효성 검사를 안해도 된다.
- 읽기가 많은 환경에 유용하다.
- 읽기와 쓰기를 다른 사람이 개발하는 경우
- 비즈니스 규칙이 자주 변하는 경우
- 이벤트 소싱과 조합해 다른 시스템과 통합해야하는 경우

## 이 패턴을 쓰지 말아야하는 경우

- 도메인 규칙이 간단한 경우
- 간단한 CRUD로 충분한 경우
- 전체 시스템에 구현하는 경우
